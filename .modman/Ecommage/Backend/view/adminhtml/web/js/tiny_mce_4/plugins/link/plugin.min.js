!function(t){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.util.VK"),o=function(t){return t.target_list},i=function(t){return t.rel_list},r=function(t){return t.link_class_list},l=o,a=function(t){return!1!==o(t)},u=i,c=function(t){return void 0!==i(t)},s=r,f=function(t){return void 0!==r(t)},d=function(t){return"boolean"==typeof t.allow_unsafe_link_target&&t.allow_unsafe_link_target},v=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),m=tinymce.util.Tools.resolve("tinymce.Env"),g=tinymce.util.Tools.resolve("tinymce.util.Tools"),h=function(t,e){var n,o,i=["noopener"],r=t?t.split(/\s+/):[],l=function(t){return t.filter((function(t){return-1===g.inArray(i,t)}))};return(r=e?(n=l(n=r)).length?n.concat(i):i:l(r)).length?(o=r,g.trim(o.sort().join(" "))):null},x=function(t,e){return e=e||t.selection.getNode(),k(e)?t.dom.select("a[href]",e)[0]:t.dom.getParent(e,"a[href]")},p=function(t){return t&&"A"===t.nodeName&&t.href},k=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},y=function(t,e){return function(n){t.undoManager.transact((function(){var o=t.selection.getNode(),i=x(t,o),r={href:n.href,target:n.target?n.target:null,rel:n.rel?n.rel:null,class:n.class?n.class:null,title:n.title?n.title:null};c(t.settings)||!1!==d(t.settings)||(r.rel=h(r.rel,"_blank"===r.target)),n.href===e.href&&(e.attach(),e={}),i?(t.focus(),n.hasOwnProperty("text")&&("innerText"in i?i.innerText=n.text:i.textContent=n.text),t.dom.setAttribs(i,r),t.selection.select(i),t.undoManager.add()):k(o)?function(t,e,n){var o,i;(i=t.dom.select("img",e)[0])&&(o=t.dom.create("a",n),i.parentNode.insertBefore(o,i),o.appendChild(i))}(t,o,r):n.hasOwnProperty("text")?t.insertContent(t.dom.createHTML("a",r,t.dom.encode(n.text))):t.execCommand("mceInsertLink",!1,r)}))}},b=function(t){return function(){t.undoManager.transact((function(){var e=t.selection.getNode();k(e)?function(t,e){var n,o;(o=t.dom.select("img",e)[0])&&(n=t.dom.getParents(o,"a[href]",e)[0])&&(n.parentNode.insertBefore(o,n),t.dom.remove(n))}(t,e):t.execCommand("unlink")}))}},_=p,w=function(t){return 0<g.grep(t,p).length},T=x,C=h,M=tinymce.util.Tools.resolve("tinymce.util.Delay"),N=tinymce.util.Tools.resolve("tinymce.util.XHR"),O={},R=function(t,e,n){var o=function(t,n){return n=n||[],g.each(t,(function(t){var i={text:t.text||t.title};t.menu?i.menu=o(t.menu):(i.value=t.value,e&&e(i)),n.push(i)})),n};return o(t,n||[])},A=function(t,e,n){var o=t.selection.getRng();M.setEditorTimeout(t,(function(){t.windowManager.confirm(e,(function(e){t.selection.setRng(o),n(e)}))}))},L=function(t,e){var n,o,i,r,v,m,h,x,p,k,_,w,M={},N=t.selection,L=t.dom,P=function(t){var e=i.find("#text");(!e.value()||t.lastControl&&e.value()===t.lastControl.text())&&e.value(t.control.text()),i.find("#href").value(t.control.value())},E=function(){o||!r||M.text||this.parent().parent().find("#text")[0].value(this.value())};r=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))}(N.getContent()),n=T(t),M.text=o=function(t,e){return(e?e.innerText||e.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")}(t.selection,n),M.href=n?L.getAttrib(n,"href"):"",n?M.target=L.getAttrib(n,"target"):function(t){return"string"==typeof t.default_link_target}(t.settings)&&(M.target=function(t){return t.default_link_target}(t.settings)),(w=L.getAttrib(n,"rel"))&&(M.rel=w),(w=L.getAttrib(n,"class"))&&(M.class=w),(w=L.getAttrib(n,"title"))&&(M.title=w),r&&(v={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){M.text=this.value()}}),e&&(m={type:"listbox",label:"Link list",values:R(e,(function(e){e.value=t.convertURL(e.value||e.url,"href")}),[{text:"None",value:""}]),onselect:P,value:t.convertURL(M.href,"href"),onPostRender:function(){m=this}}),a(t.settings)&&(void 0===l(t.settings)&&function(t,e){t.settings.target_list=e}(t,[{text:"None",value:""},{text:"New window",value:"_blank"}]),x={name:"target",type:"listbox",label:"Target",values:R(l(t.settings))}),c(t.settings)&&(h={name:"rel",type:"listbox",label:"Rel",values:R(u(t.settings),(function(e){!1===d(t.settings)&&(e.value=C(e.value,"_blank"===M.target))}))}),f(t.settings)&&(p={name:"class",type:"listbox",label:"Class",values:R(s(t.settings),(function(e){e.value&&(e.textStyle=function(){return t.formatter.getCssText({inline:"a",classes:[e.value]})})}))}),function(t){return!1!==t.link_title}(t.settings)&&(k={name:"title",type:"textbox",label:"Title",value:M.title}),function(t){return!1!==t.link_rel}(t.settings)&&(_={name:"rel",type:"listbox",label:"No Follow",values:[{text:"No",value:""},{text:"Yes",value:"nofollow"}]}),i=t.windowManager.open({title:"Insert link",data:M,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:function(e){var n=e.meta||{};m&&m.value(t.convertURL(this.value(),"href")),g.each(e.meta,(function(t,e){var n=i.find("#"+e);"text"===e?0===o.length&&(n.value(t),M.text=t):n.value(t)})),n.attach&&(O={href:this.value(),attach:n.attach}),n.text||E.call(this)},onkeyup:E,onpaste:E,onbeforecall:function(t){t.meta=i.toJSON()}},v,k,_,function(e){var n=[];if(g.each(t.dom.select("a:not([href])"),(function(t){var o=t.name||t.id;o&&n.push({text:o,value:"#"+o,selected:-1!==e.indexOf("#"+o)})})),n.length)return n.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:n,onselect:P}}(M.href),m,h,x,p],onSubmit:function(e){var n=function(t){return"boolean"==typeof t.link_assume_external_targets&&t.link_assume_external_targets}(t.settings),i=y(t,O),l=b(t),a=g.extend({},M,e.data),u=a.href;u?(r&&a.text!==o||delete a.text,0<u.indexOf("@")&&-1===u.indexOf("//")&&-1===u.indexOf("mailto:")?A(t,"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",(function(t){t&&(a.href="mailto:"+u),i(a)})):!0===n&&!/^\w+:/i.test(u)||!1===n&&/^\s*www[\.|\d\.]/i.test(u)?A(t,"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",(function(t){t&&(a.href="http://"+u),i(a)})):i(a)):l()}})},P=function(t,e){return t.dom.getParent(e,"a[href]")},E=function(t){return P(t,t.selection.getStart())},S=function(e,n){if(n){var o=(r=n).getAttribute("data-mce-href")||r.getAttribute("href");if(/^#/.test(o)){var i=e.$(o);i.length&&e.selection.scrollIntoView(i[0],!0)}else!function(e){if(!m.ie||10<m.ie){var n=t.document.createElement("a");n.target="_blank",n.href=e,n.rel="noreferrer noopener";var o=t.document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,t.window,0,0,0,0,0,!1,!1,!1,!1,0,null),l=n,a=o,t.document.body.appendChild(l),l.dispatchEvent(a),t.document.body.removeChild(l)}else{var i=t.window.open("","_blank");if(i){i.opener=null;var r=i.document;r.open(),r.write('<meta http-equiv="refresh" content="0; url='+v.DOM.encode(e)+'">'),r.close()}}var l,a}(n.href)}var r},I=function(t){return function(){!function(t){var e,n,o;n=L,"string"==typeof(o=function(t){return t.link_list}((e=t).settings))?N.send({url:o,success:function(t){n(e,JSON.parse(t))}}):"function"==typeof o?o((function(t){n(e,t)})):n(e,o)}(t)}},K=function(t){return function(){S(t,E(t))}},U=function(t){return function(){var e=this;t.on("nodechange",(function(n){e.active(!t.readonly&&!!T(t,n.element))}))}},D=function(t){return function(){var e=this,n=function(t){w(t.parents)?e.show():e.hide()};w(t.dom.getParents(t.selection.getStart()))||e.hide(),t.on("nodechange",n),e.on("remove",(function(){t.off("nodechange",n)}))}},B=function(t){t.addContextToolbar&&t.addContextToolbar(function(t){return function(e){var n,o,i,r;return!!(function(t){return"boolean"==typeof t.link_context_toolbar&&t.link_context_toolbar}(t.settings)&&(!(r=t.plugins.contextmenu)||!r.isContextMenuVisible())&&_(e)&&3===(i=(o=(n=t.selection).getRng()).startContainer).nodeType&&n.isCollapsed()&&0<o.startOffset&&o.startOffset<i.data.length)}}(t),"openlink | link unlink")};e.add("link",(function(t){(function(t){t.addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:I(t),onpostrender:U(t)}),t.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",onclick:b(t),onpostrender:U(t)}),t.addContextToolbar&&t.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:K(t)})})(t),function(t){t.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:K(t),onPostRender:D(t),prependToContext:!0}),t.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:I(t),stateSelector:"a[href]",context:"insert",prependToContext:!0}),t.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onclick:b(t),stateSelector:"a[href]"})}(t),B(t),function(t){t.on("click",(function(e){var o=P(t,e.target);o&&n.metaKeyPressed(e)&&(e.preventDefault(),S(t,o))})),t.on("keydown",(function(e){var n,o=E(t);o&&13===e.keyCode&&!0===(n=e).altKey&&!1===n.shiftKey&&!1===n.ctrlKey&&!1===n.metaKey&&(e.preventDefault(),S(t,o))}))}(t),function(t){t.addCommand("mceLink",I(t))}(t),function(t){t.addShortcut("Meta+K","",I(t))}(t)}))}(window);
